"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[692],{99604:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});var n=s(72791),a=s(57689),o=s(11135),i=s(23814),l=s(61889),r=s(45248),c=s(57482),d=s(74794),u=s(28371),m=s(26181),x=s.n(m),p=s(25787),f=s(21435),v=s(35527),g=s(81207),h=s(90673),y=s(41320),j=s(78687),b=s(40968),C=s(56578),N=s(45830),_=s(80007),P=s(80184);const Z=(0,p.Z)((e=>(0,o.Z)({bottomContainer:{display:"flex",flexGrow:1,alignItems:"center",margin:"auto",justifyContent:"center","& div":{width:150,"@media (max-width: 900px)":{flexFlow:"column"}}},factorElements:{display:"flex",justifyContent:"flex-start",marginLeft:30},sizeNumber:{fontSize:35,fontWeight:700,textAlign:"center"},sizeDescription:{fontSize:14,color:"#777",textAlign:"center"},...i.DF,...i.AK})))((e=>{let{classes:t}=e;const s=(0,y.TL)(),a=(0,j.v9)((e=>e.tenants.tenantInfo)),o=(0,j.v9)((e=>e.addPool.storageClasses)),i=(0,j.v9)((e=>e.addPool.setup.numberOfNodes.toString())),c=(0,j.v9)((e=>e.addPool.setup.storageClass)),d=(0,j.v9)((e=>e.addPool.setup.volumeSize.toString())),u=(0,j.v9)((e=>e.addPool.setup.volumesPerServer.toString())),[m,p]=(0,n.useState)({}),Z=1073741824*parseInt(d)*parseInt(u),A=Z*parseInt(i);(0,n.useEffect)((()=>{let e=[{fieldKey:"number_of_nodes",required:!0,value:i.toString(),customValidation:parseInt(i)<1||isNaN(parseInt(i)),customValidationMessage:"Number of servers must be at least 1"},{fieldKey:"pool_size",required:!0,value:d.toString(),customValidation:parseInt(d)<1||isNaN(parseInt(d)),customValidationMessage:"Pool Size cannot be 0"},{fieldKey:"volumes_per_server",required:!0,value:u.toString(),customValidation:parseInt(u)<1||isNaN(parseInt(u)),customValidationMessage:"1 volume or more are required"}];const t=(0,b.R)(e);s((0,N.LJ)({page:"setup",status:0===Object.keys(t).length})),p(t)}),[s,i,d,u,c]),(0,n.useEffect)((()=>{0===o.length&&a&&g.Z.invoke("GET","/api/v1/namespaces/".concat(a.namespace,"/resourcequotas/").concat(a.namespace,"-storagequota")).then((e=>{const t=x()(e,"elements",[]).map((e=>{const t=x()(e,"name","").split(".storageclass.storage.k8s.io/requests.storage")[0];return{label:t,value:t}}));s((0,N.oo)({page:"setup",field:"storageClass",value:t[0].value})),s((0,N.TU)(t))})).catch((e=>{console.error(e)}))}),[a,o,s]);const S=(e,t)=>{s((0,N.oo)({page:"setup",field:e,value:t}))};return(0,P.jsxs)(v.Z,{className:t.paperWrapper,children:[(0,P.jsxs)("div",{className:t.headerElement,children:[(0,P.jsx)(_.Z,{children:"New Pool Configuration"}),(0,P.jsx)("span",{className:t.descriptionText,children:"Configure a new Pool to expand MinIO storage"})]}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.formFieldRow,children:(0,P.jsx)(f.Z,{id:"number_of_nodes",name:"number_of_nodes",onChange:e=>{const t=parseInt(e.target.value);e.target.validity.valid&&!isNaN(t)?S("numberOfNodes",t):isNaN(t)&&S("numberOfNodes",0)},label:"Number of Servers",value:i,error:m.number_of_nodes||"",pattern:"[0-9]*"})}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.formFieldRow,children:(0,P.jsx)(f.Z,{id:"pool_size",name:"pool_size",onChange:e=>{const t=parseInt(e.target.value);e.target.validity.valid&&!isNaN(t)?S("volumeSize",t):isNaN(t)&&S("volumeSize",0)},label:"Volume Size",value:d,error:m.pool_size||"",pattern:"[0-9]*",overlayObject:(0,P.jsx)(C.Z,{id:"quota_unit",onUnitChange:()=>{},unitSelected:"Gi",unitsList:[{label:"Gi",value:"Gi"}],disabled:!0})})}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.formFieldRow,children:(0,P.jsx)(f.Z,{id:"volumes_per_sever",name:"volumes_per_sever",onChange:e=>{const t=parseInt(e.target.value);e.target.validity.valid&&!isNaN(t)?S("volumesPerServer",t):isNaN(t)&&S("volumesPerServer",0)},label:"Volumes per Server",value:u,error:m.volumes_per_server||"",pattern:"[0-9]*"})}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.formFieldRow,children:(0,P.jsx)(h.Z,{id:"storage_class",name:"storage_class",onChange:e=>{S("storageClass",e.target.value)},label:"Storage Class",value:c,options:o,disabled:o.length<1})}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.bottomContainer,children:(0,P.jsxs)("div",{className:t.factorElements,children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:t.sizeNumber,children:(0,r.ae)(Z.toString(10))}),(0,P.jsx)("div",{className:t.sizeDescription,children:"Instance Capacity"})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{className:t.sizeNumber,children:(0,r.ae)(A.toString(10))}),(0,P.jsx)("div",{className:t.sizeDescription,children:"Total Capacity"})]})]})})]})}));var A=s(14917),S=s(75952),k=s(84741),I=s(37516);const w=(0,p.Z)((e=>(0,o.Z)({configSectionItem:{marginRight:15,"& .multiContainer":{border:"1px solid red"}},tenantCustomizationFields:{marginLeft:30,width:"88%",margin:"auto"},containerItem:{marginRight:15},fieldGroup:{...i.QV.fieldGroup,paddingTop:15,marginBottom:25},responsiveSectionItem:{"@media (max-width: 900px)":{flexFlow:"column",alignItems:"flex-start","& div > div":{marginBottom:5,marginRight:0}}},...i.oO,...i.AK})))((e=>{let{classes:t}=e;const s=(0,y.TL)(),a=(0,j.v9)((e=>e.addPool.configuration.securityContextEnabled)),o=(0,j.v9)((e=>e.addPool.configuration.securityContext)),i=(0,j.v9)((e=>e.addPool.configuration.customRuntime)),r=(0,j.v9)((e=>e.addPool.configuration.runtimeClassName)),[c,d]=(0,n.useState)({}),u=(0,n.useCallback)(((e,t)=>{s((0,N.oo)({page:"configuration",field:e,value:t}))}),[s]);(0,n.useEffect)((()=>{let e=[];a&&(e=[{fieldKey:"pool_securityContext_runAsUser",required:!0,value:o.runAsUser,customValidation:""===o.runAsUser||parseInt(o.runAsUser)<0,customValidationMessage:"runAsUser must be present and be 0 or more"},{fieldKey:"pool_securityContext_runAsGroup",required:!0,value:o.runAsGroup,customValidation:""===o.runAsGroup||parseInt(o.runAsGroup)<0,customValidationMessage:"runAsGroup must be present and be 0 or more"},{fieldKey:"pool_securityContext_fsGroup",required:!0,value:o.fsGroup,customValidation:""===o.fsGroup||parseInt(o.fsGroup)<0,customValidationMessage:"fsGroup must be present and be 0 or more"}]);const t=(0,b.R)(e);s((0,N.LJ)({page:"configure",status:0===Object.keys(t).length})),d(t)}),[s,a,o]);const m=e=>{d((0,k.h)(c,e))};return(0,P.jsxs)(v.Z,{className:t.paperWrapper,children:[(0,P.jsxs)("div",{className:t.headerElement,children:[(0,P.jsx)(_.Z,{children:"Configure"}),(0,P.jsx)("span",{className:t.descriptionText,children:"Aditional Configurations for the new Pool"})]}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.configSectionItem,children:(0,P.jsx)(I.Z,{value:"tenantConfig",id:"pool_configuration",name:"pool_configuration",checked:a,onChange:e=>{const t=e.target.checked;u("securityContextEnabled",t)},label:"Security Context"})}),a&&(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.tenantCustomizationFields,children:(0,P.jsxs)("fieldset",{className:t.fieldGroup,children:[(0,P.jsx)("legend",{className:t.descriptionText,children:"Pool's Security Context"}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:"".concat(t.configSectionItem),children:(0,P.jsxs)("div",{className:"".concat(t.multiContainer," ").concat(t.responsiveSectionItem),children:[(0,P.jsx)("div",{className:t.containerItem,children:(0,P.jsx)(f.Z,{type:"number",id:"pool_securityContext_runAsUser",name:"pool_securityContext_runAsUser",onChange:e=>{u("securityContext",{...o,runAsUser:e.target.value}),m("pool_securityContext_runAsUser")},label:"Run As User",value:o.runAsUser,required:!0,error:c.pool_securityContext_runAsUser||"",min:"0"})}),(0,P.jsx)("div",{className:t.containerItem,children:(0,P.jsx)(f.Z,{type:"number",id:"pool_securityContext_runAsGroup",name:"pool_securityContext_runAsGroup",onChange:e=>{u("securityContext",{...o,runAsGroup:e.target.value}),m("pool_securityContext_runAsGroup")},label:"Run As Group",value:o.runAsGroup,required:!0,error:c.pool_securityContext_runAsGroup||"",min:"0"})}),(0,P.jsx)("div",{className:t.containerItem,children:(0,P.jsx)(f.Z,{type:"number",id:"pool_securityContext_fsGroup",name:"pool_securityContext_fsGroup",onChange:e=>{u("securityContext",{...o,fsGroup:e.target.value}),m("pool_securityContext_fsGroup")},label:"FsGroup",value:o.fsGroup,required:!0,error:c.pool_securityContext_fsGroup||"",min:"0"})})]})}),(0,P.jsx)("br",{}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.configSectionItem,children:(0,P.jsx)("div",{className:t.multiContainer,children:(0,P.jsx)(I.Z,{value:"securityContextRunAsNonRoot",id:"pool_securityContext_runAsNonRoot",name:"pool_securityContext_runAsNonRoot",checked:o.runAsNonRoot,onChange:e=>{const t=e.target.checked;u("securityContext",{...o,runAsNonRoot:t})},label:"Do not run as Root"})})})]})}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.configSectionItem,sx:{marginTop:"10px"},children:(0,P.jsx)(I.Z,{value:"customRuntime",id:"tenant_custom_runtime",name:"tenant_custom_runtime",checked:i,onChange:e=>{const t=e.target.checked;u("customRuntime",t)},label:"Custom Runtime Configurations"})}),i&&(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.tenantCustomizationFields,children:(0,P.jsxs)("fieldset",{className:t.fieldGroup,children:[(0,P.jsx)("legend",{className:t.descriptionText,children:"Custom Runtime Configurations"}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:"".concat(t.configSectionItem),children:(0,P.jsx)("div",{className:t.containerItem,children:(0,P.jsx)(f.Z,{id:"tenant_runtime_runtimeClassName",name:"tenant_runtime_runtimeClassName",onChange:e=>{u("runtimeClassName",e.target.value),m("tenant_runtime_runtimeClassName")},label:"Runtime Class Name",value:r,error:c.tenant_runtime_runtimeClassName||""})})})]})})]})}));var F=s(13400),G=s(83679),R=s(45660),z=s(87995);const T=(0,p.Z)((e=>(0,o.Z)({overlayAction:{marginLeft:10,display:"flex",alignItems:"center","& svg":{maxWidth:15,maxHeight:15},"& button":{background:"#EAEAEA"}},affinityConfigField:{display:"flex"},affinityFieldLabel:{display:"flex",flexFlow:"column",flex:1},radioField:{display:"flex",alignItems:"flex-start",marginTop:10,"& div:first-child":{display:"flex",flexFlow:"column",alignItems:"baseline",textAlign:"left !important"}},affinityLabelKey:{"& div:first-child":{marginBottom:0}},affinityLabelValue:{marginLeft:10,"& div:first-child":{marginBottom:0}},rowActions:{display:"flex",alignItems:"center"},affinityRow:{marginBottom:10,display:"flex"},...i.oO,...i.AK})))((e=>{let{classes:t}=e;const s=(0,y.TL)(),a=(0,j.v9)((e=>e.addPool.affinity.podAffinity)),o=(0,j.v9)((e=>e.addPool.affinity.nodeSelectorLabels)),i=(0,j.v9)((e=>e.addPool.affinity.withPodAntiAffinity)),r=(0,j.v9)((e=>e.addPool.nodeSelectorPairs)),c=(0,j.v9)((e=>e.addPool.tolerations)),[d,u]=(0,n.useState)({}),[m,x]=(0,n.useState)(!0),[p,C]=(0,n.useState)({}),[Z,A]=(0,n.useState)([]),k=(0,n.useCallback)(((e,t)=>{s((0,N.oo)({page:"affinity",field:e,value:t}))}),[s]);(0,n.useEffect)((()=>{m&&g.Z.invoke("GET","/api/v1/nodes/labels").then((e=>{x(!1),C(e);let t=[];for(let s in e)t.push({label:s,value:s});A(t)})).catch((e=>{x(!1),s((0,z.zb)(e)),C({})}))}),[s,m]),(0,n.useEffect)((()=>{if(r){const e=r.filter((e=>""!==e.key)).map((e=>"".concat(e.key,"=").concat(e.value))).filter(((e,t,s)=>s.indexOf(e)===t)).join("&");k("nodeSelectorLabels",e)}}),[r,k]),(0,n.useEffect)((()=>{let e=[];if("nodeSelector"===a){let t=!0;const s=o.split("&");1===s.length&&""===s[0]&&(t=!1),s.forEach(((e,n)=>{const a=e.split("=");2!==a.length&&(t=!1),n+1!==s.length&&(""!==a[0]&&""!==a[1]||(t=!1))})),e=[...e,{fieldKey:"labels",required:!0,value:o,customValidation:!t,customValidationMessage:"You need to add at least one label key-pair"}]}const t=(0,b.R)(e);s((0,N.LJ)({page:"affinity",status:0===Object.keys(t).length})),u(t)}),[s,a,o]);const w=(e,t,n)=>{const a={...c[e],[t]:n};s((0,N.fu)({index:e,tolerationValue:a}))};return(0,P.jsxs)(v.Z,{className:t.paperWrapper,children:[(0,P.jsxs)("div",{className:t.headerElement,children:[(0,P.jsx)(_.Z,{children:"Pod Placement"}),(0,P.jsx)("span",{className:t.descriptionText,children:"Configure how pods will be assigned to nodes"})]}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.affinityConfigField,children:(0,P.jsxs)(l.ZP,{item:!0,className:t.affinityFieldLabel,children:[(0,P.jsx)("div",{className:t.label,children:"Type"}),(0,P.jsx)("div",{className:"".concat(t.descriptionText," ").concat(t.affinityHelpText),children:"MinIO supports multiple configurations for Pod Affinity"}),(0,P.jsx)(l.ZP,{item:!0,className:t.radioField,children:(0,P.jsx)(G.Z,{currentSelection:a,id:"affinity-options",name:"affinity-options",label:" ",onChange:e=>{k("podAffinity",e.target.value)},selectorOptions:[{label:"None",value:"none"},{label:"Default (Pod Anti-Affinity)",value:"default"},{label:"Node Selector",value:"nodeSelector"}]})})]})}),"nodeSelector"===a&&(0,P.jsxs)(n.Fragment,{children:[(0,P.jsx)("br",{}),(0,P.jsx)(l.ZP,{item:!0,xs:12,children:(0,P.jsx)(I.Z,{value:"with_pod_anti_affinity",id:"with_pod_anti_affinity",name:"with_pod_anti_affinity",checked:i,onChange:e=>{const t=e.target.checked;k("withPodAntiAffinity",t)},label:"With Pod Anti-Affinity"})}),(0,P.jsxs)(l.ZP,{item:!0,xs:12,children:[(0,P.jsx)("h3",{children:"Labels"}),(0,P.jsx)("span",{className:t.error,children:d.labels}),(0,P.jsx)(l.ZP,{container:!0,children:r&&r.map(((e,n)=>(0,P.jsxs)(l.ZP,{item:!0,xs:12,className:t.affinityRow,children:[(0,P.jsxs)(l.ZP,{item:!0,xs:5,className:t.affinityLabelKey,children:[Z.length>0&&(0,P.jsx)(h.Z,{onChange:e=>{const t=e.target.value,a={key:t,value:p[t][0]},o=[...r];o[n]=a,s((0,N.bF)(o))},id:"select-access-policy",name:"select-access-policy",label:"",value:e.key,options:Z}),0===Z.length&&(0,P.jsx)(f.Z,{id:"nodeselector-key-".concat(n.toString()),label:"",name:"nodeselector-".concat(n.toString()),value:e.key,onChange:e=>{const t=[...r];t[n]={key:t[n].key,value:e.target.value},s((0,N.bF)(t))},index:n,placeholder:"Key"})]}),(0,P.jsxs)(l.ZP,{item:!0,xs:5,className:t.affinityLabelValue,children:[Z.length>0&&(0,P.jsx)(h.Z,{onChange:e=>{const t=[...r];t[n]={key:t[n].key,value:e.target.value},s((0,N.bF)(t))},id:"select-access-policy",name:"select-access-policy",label:"",value:e.value,options:p[e.key]?p[e.key].map((e=>({label:e,value:e}))):[]}),0===Z.length&&(0,P.jsx)(f.Z,{id:"nodeselector-value-".concat(n.toString()),label:"",name:"nodeselector-".concat(n.toString()),value:e.value,onChange:e=>{const t=[...r];t[n]={key:t[n].key,value:e.target.value},s((0,N.bF)(t))},index:n,placeholder:"value"})]}),(0,P.jsxs)(l.ZP,{item:!0,xs:2,className:t.rowActions,children:[(0,P.jsx)("div",{className:t.overlayAction,children:(0,P.jsx)(F.Z,{size:"small",onClick:()=>{const e=[...r];Z.length>0?e.push({key:Z[0].value,value:p[Z[0].value][0]}):e.push({key:"",value:""}),s((0,N.bF)(e))},children:(0,P.jsx)(S.dtP,{})})}),r.length>1&&(0,P.jsx)("div",{className:t.overlayAction,children:(0,P.jsx)(F.Z,{size:"small",onClick:()=>{const e=r.filter(((e,t)=>t!==n));s((0,N.bF)(e))},children:(0,P.jsx)(S.HFL,{})})})]})]},"affinity-keyVal-".concat(n.toString()))))})]})]}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:t.affinityConfigField,children:(0,P.jsxs)(l.ZP,{item:!0,className:t.affinityFieldLabel,children:[(0,P.jsx)("h3",{children:"Tolerations"}),(0,P.jsx)("span",{className:t.error,children:d.tolerations}),(0,P.jsx)(l.ZP,{container:!0,children:c&&c.map(((e,n)=>{var a;return(0,P.jsxs)(l.ZP,{item:!0,xs:12,className:t.affinityRow,children:[(0,P.jsx)(R.Z,{effect:e.effect,onEffectChange:e=>{w(n,"effect",e)},tolerationKey:e.key,onTolerationKeyChange:e=>{w(n,"key",e)},operator:e.operator,onOperatorChange:e=>{w(n,"operator",e)},value:e.value,onValueChange:e=>{w(n,"value",e)},tolerationSeconds:(null===(a=e.tolerationSeconds)||void 0===a?void 0:a.seconds)||0,onSecondsChange:e=>{w(n,"tolerationSeconds",{seconds:e})},index:n}),(0,P.jsx)("div",{className:t.overlayAction,children:(0,P.jsx)(F.Z,{size:"small",onClick:()=>{s((0,N.hw)())},disabled:n!==c.length-1,children:(0,P.jsx)(S.dtP,{})})}),(0,P.jsx)("div",{className:t.overlayAction,children:(0,P.jsx)(F.Z,{size:"small",onClick:()=>s((0,N.GF)(n)),disabled:c.length<=1,children:(0,P.jsx)(S.HFL,{})})})]},"affinity-keyVal-".concat(n.toString()))}))})]})})]})}));var E=s(85617);const L=()=>{const e=(0,y.TL)(),t=(0,j.v9)((e=>e.addPool.setup.storageClass)),s=(0,j.v9)((e=>e.addPool.validPages)),n=!(0,j.v9)((e=>e.addPool.sending))&&""!==t&&["setup","affinity","configure"].every((e=>s.includes(e)));return(0,P.jsx)(S.zxk,{id:"wizard-button-Create",variant:"callAction",onClick:()=>{e((0,E.P)())},disabled:!n,label:"Create"},"button-AddTenant-Create")};var V=s(72455),O=s(47974);const U=(0,V.Z)((e=>(0,o.Z)({bottomContainer:{display:"flex",flexGrow:1,alignItems:"center",margin:"auto",justifyContent:"center","& div":{width:150,"@media (max-width: 900px)":{flexFlow:"column"}}},pageBox:{border:"1px solid #EAEAEA",borderTop:0},addPoolTitle:{border:"1px solid #EAEAEA",borderBottom:0},...i.DF,...i.ID}))),q=()=>{const e=(0,y.TL)(),t=(0,a.s0)(),s=U(),o=(0,j.v9)((e=>e.tenants.tenantInfo)),i=(0,j.v9)((e=>e.addPool.sending)),m=(0,j.v9)((e=>e.addPool.navigateTo)),x="/namespaces/".concat((null===o||void 0===o?void 0:o.namespace)||"","/tenants/").concat((null===o||void 0===o?void 0:o.name)||"","/pools");(0,n.useEffect)((()=>{if(""!==m){const s="".concat(m);e((0,N.bU)()),t(s)}}),[m,t,e]);const p={label:"Cancel",type:"other",enabled:!0,action:()=>{e((0,N.bU)()),t(x)}},f={componentRender:(0,P.jsx)(L,{},"add-pool-crate")},v=[{label:"Setup",componentRender:(0,P.jsx)(Z,{}),buttons:[p,f]},{label:"Configuration",advancedOnly:!0,componentRender:(0,P.jsx)(w,{}),buttons:[p,f]},{label:"Pod Placement",advancedOnly:!0,componentRender:(0,P.jsx)(T,{}),buttons:[p,f]}];return(0,P.jsx)(n.Fragment,{children:(0,P.jsxs)(l.ZP,{item:!0,xs:12,children:[(0,P.jsx)(O.Z,{label:(0,P.jsx)(n.Fragment,{children:(0,P.jsx)(S.hbI,{label:"Tenant Pools",onClick:()=>t(x)})})}),(0,P.jsxs)(d.Z,{children:[(0,P.jsx)(l.ZP,{item:!0,xs:12,className:s.addPoolTitle,children:(0,P.jsx)(A.Z,{icon:(0,P.jsx)(S.zb0,{}),title:"Add New Pool to ".concat((null===o||void 0===o?void 0:o.name)||""),subTitle:(0,P.jsxs)(n.Fragment,{children:["Namespace: ",(null===o||void 0===o?void 0:o.namespace)||""," / Current Capacity:"," ",(0,r.ae)(((null===o||void 0===o?void 0:o.total_size)||0).toString(10))]})})}),i&&(0,P.jsx)(l.ZP,{item:!0,xs:12,children:(0,P.jsx)(c.Z,{})}),(0,P.jsx)(l.ZP,{item:!0,xs:12,className:s.pageBox,children:(0,P.jsx)(u.Z,{wizardSteps:v})})]})]})})}}}]);
//# sourceMappingURL=692.df969bf6.chunk.js.map