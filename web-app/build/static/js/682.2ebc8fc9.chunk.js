"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[682],{7403:(e,a,t)=>{t.d(a,{U:()=>r,_:()=>n});const n={label:{color:"#07193E",fontSize:13,alignSelf:"center",whiteSpace:"nowrap","&:not(:first-of-type)":{marginLeft:10}},actionsTray:{display:"flex",justifyContent:"space-between",marginBottom:"1rem",alignItems:"center","& button":{flexGrow:0,marginLeft:8}}},r={modalButtonBar:{marginTop:15,display:"flex",alignItems:"center",justifyContent:"flex-end","& button":{marginRight:10},"& button:last-child":{marginRight:0}},modalFormScrollable:{maxHeight:"calc(100vh - 300px)",overflowY:"auto",paddingTop:10}}},4682:(e,a,t)=>{t.r(a),t.d(a,{default:()=>m});var n=t(5043),r=t(9923),i=t(9456),l=t(7403),s=t(969),o=t(788),d=t(4159),c=t(2961),u=t(8661),p=t(649),_=t(579);const m=()=>{const e=(0,c.jL)(),a=(0,i.d4)((e=>e.tenants.tenantInfo)),t=(0,i.d4)((e=>e.tenants.loadingTenant)),[m,h]=(0,n.useState)(!1),[g,v]=(0,n.useState)(!1),[x,D]=(0,n.useState)("Built-in"),[j,S]=(0,n.useState)(""),[b,I]=(0,n.useState)(""),[f,y]=(0,n.useState)(""),[k,C]=(0,n.useState)(""),[A,N]=(0,n.useState)(""),[L,B]=(0,n.useState)(""),[w,O]=(0,n.useState)(""),[T,R]=(0,n.useState)(""),[U,F]=(0,n.useState)(""),[z,G]=(0,n.useState)(""),[q,K]=(0,n.useState)(""),[P,J]=(0,n.useState)(""),[M,E]=(0,n.useState)(""),[H,V]=(0,n.useState)(!1),[$,W]=(0,n.useState)(!1),[Y,Z]=(0,n.useState)(!1),[Q,X]=(0,n.useState)([""]),[ee,ae]=(0,n.useState)([""]),[te,ne]=(0,n.useState)({}),re=e=>{ne((0,s.p)(te,e))},[ie,le]=(0,n.useState)(!1);(0,n.useEffect)((()=>{let e=[];"OpenID"===x&&(e=[...e,{fieldKey:"openID_CONFIGURATION_URL",required:!0,value:j},{fieldKey:"openID_clientID",required:!0,value:b},{fieldKey:"openID_secretID",required:!0,value:f},{fieldKey:"openID_claimName",required:!1,value:A}]),"AD"===x&&(e=[...e,{fieldKey:"AD_URL",required:!0,value:w},{fieldKey:"ad_lookupBindDN",required:!0,value:T}]);const a=(0,o.D)(e);le(0===Object.keys(a).length),ne(a)}),[x,j,b,f,A,w,T]);const se=(0,n.useCallback)((()=>{p.A.invoke("GET","/api/v1/namespaces/".concat(null===a||void 0===a?void 0:a.namespace,"/tenants/").concat(null===a||void 0===a?void 0:a.name,"/identity-provider")).then((e=>{e&&(e.oidc?(D("OpenID"),S(e.oidc.configuration_url),I(e.oidc.client_id),y(e.oidc.secret_id),C(e.oidc.callback_url),N(e.oidc.claim_name),B(e.oidc.scopes)):e.active_directory&&(D("AD"),O(e.active_directory.url),R(e.active_directory.lookup_bind_dn),F(e.active_directory.lookup_bind_password),G(e.active_directory.user_dn_search_base_dn),K(e.active_directory.user_dn_search_filter),J(e.active_directory.group_search_base_dn),E(e.active_directory.group_search_filter),V(e.active_directory.skip_tls_verification),W(e.active_directory.server_insecure),Z(e.active_directory.server_start_tls)))})).catch((a=>{e((0,d.C9)(a))}))}),[a,e]);(0,n.useEffect)((()=>{a&&se()}),[a,se]);return(0,_.jsxs)(n.Fragment,{children:[(0,_.jsx)(u.A,{title:"Save and Restart",confirmText:"Restart",cancelText:"Cancel",titleIcon:(0,_.jsx)(r.$rg,{}),isLoading:m,onClose:()=>v(!1),isOpen:g,onConfirm:()=>{h(!0);let t={};switch(x){case"AD":t.active_directory={url:w,lookup_bind_dn:T,lookup_bind_password:U,user_dn_search_base_dn:z,user_dn_search_filter:q,group_search_base_dn:P,group_search_filter:M,skip_tls_verification:H,server_insecure:$,server_start_tls:Y};break;case"OpenID":t.oidc={configuration_url:j,client_id:b,secret_id:f,callback_url:k,claim_name:A,scopes:L}}p.A.invoke("POST","/api/v1/namespaces/".concat(null===a||void 0===a?void 0:a.namespace,"/tenants/").concat(null===a||void 0===a?void 0:a.name,"/identity-provider"),t).then((()=>{h(!1),v(!1),se()})).catch((a=>{e((0,d.C9)(a)),h(!1)}))},confirmationContent:(0,_.jsx)(n.Fragment,{children:"Are you sure you want to save the changes and restart the service?"})}),t?(0,_.jsx)(r.azJ,{sx:{textAlign:"center"},children:(0,_.jsx)(r.aHM,{})}):(0,_.jsxs)(n.Fragment,{children:[(0,_.jsx)(r.azJ,{children:(0,_.jsx)(r._xt,{separator:!0,sx:{marginBottom:15},children:"Identity Provider"})}),(0,_.jsxs)(r.Hbc,{children:[(0,_.jsx)(r.z6M,{currentValue:x,id:"idp-options",name:"idp-options",label:"Protocol",onChange:e=>{D(e.target.value)},selectorOptions:[{label:"Built-in",value:"Built-in",icon:(0,_.jsx)(r.c2u,{})},{label:"Open ID",value:"OpenID",icon:(0,_.jsx)(r.Z4D,{})},{label:"LDAP / Active Directory",value:"AD",icon:(0,_.jsx)(r.Tp8,{})}]}),"OpenID"===x&&(0,_.jsxs)(n.Fragment,{children:[(0,_.jsx)(r.cl_,{id:"openID_CONFIGURATION_URL",name:"openID_CONFIGURATION_URL",onChange:e=>{S(e.target.value),re("openID_CONFIGURATION_URL")},label:"Configuration URL",value:j,placeholder:"https://your-identity-provider.com/.well-known/openid-configuration",error:te.openID_CONFIGURATION_URL||"",required:!0}),(0,_.jsx)(r.cl_,{id:"openID_clientID",name:"openID_clientID",onChange:e=>{I(e.target.value),re("openID_clientID")},label:"Client ID",value:b,error:te.openID_clientID||"",required:!0}),(0,_.jsx)(r.cl_,{type:"password",id:"openID_secretID",name:"openID_secretID",onChange:e=>{y(e.target.value),re("openID_secretID")},label:"Secret ID",value:f,error:te.openID_secretID||"",required:!0}),(0,_.jsx)(r.cl_,{id:"openID_claimName",name:"openID_claimName",onChange:e=>{N(e.target.value),re("openID_claimName")},label:"Claim Name",value:A,placeholder:"policy",error:te.openID_claimName||""}),(0,_.jsx)(r.cl_,{id:"openID_scopes",name:"openID_scopes",onChange:e=>{B(e.target.value),re("openID_scopes")},label:"Scopes",value:L})]}),"AD"===x&&(0,_.jsxs)(n.Fragment,{children:[(0,_.jsx)(r.cl_,{id:"AD_URL",name:"AD_URL",onChange:e=>{O(e.target.value),re("AD_URL")},label:"LDAP Server Address",value:w,placeholder:"ldap-server:636",error:te.AD_URL||"",required:!0}),(0,_.jsx)(r.dOG,{value:"ad_skipTLS",id:"ad_skipTLS",name:"ad_skipTLS",checked:H,onChange:e=>{const a=e.target.checked;V(a)},label:"Skip TLS Verification"}),(0,_.jsx)(r.dOG,{value:"ad_serverInsecure",id:"ad_serverInsecure",name:"ad_serverInsecure",checked:$,onChange:e=>{const a=e.target.checked;W(a)},label:"Server Insecure"}),$?(0,_.jsx)(r.Wei,{title:"Warning",message:"All traffic with Active Directory will be\n                    unencrypted",variant:"warning",sx:{marginBottom:15}}):null,(0,_.jsx)(r.dOG,{value:"ad_serverStartTLS",id:"ad_serverStartTLS",name:"ad_serverStartTLS",checked:Y,onChange:e=>{const a=e.target.checked;Z(a)},label:"Start TLS connection to AD/LDAP server"}),(0,_.jsx)(r.cl_,{id:"ad_lookupBindDN",name:"ad_lookupBindDN",onChange:e=>{R(e.target.value),re("ad_lookupBindDN")},label:"Lookup Bind DN",value:T,placeholder:"cn=admin,dc=min,dc=io",error:te.ad_lookupBindDN||"",required:!0}),(0,_.jsx)(r.cl_,{type:"password",id:"ad_lookupBindPassword",name:"ad_lookupBindPassword",onChange:e=>{F(e.target.value)},label:"Lookup Bind Password",value:U,placeholder:"admin"}),(0,_.jsx)(r.cl_,{id:"ad_userDNSearchBaseDN",name:"ad_userDNSearchBaseDN",onChange:e=>{G(e.target.value)},label:"User DN Search Base DN",value:z,placeholder:"dc=min,dc=io"}),(0,_.jsx)(r.cl_,{id:"ad_userDNSearchFilter",name:"ad_userDNSearchFilter",onChange:e=>{K(e.target.value)},label:"User DN Search Filter",value:q,placeholder:"(sAMAcountName=%s)"}),(0,_.jsx)(r.cl_,{id:"ad_groupSearchBaseDN",name:"ad_groupSearchBaseDN",onChange:e=>{J(e.target.value)},label:"Group Search Base DN",value:P,placeholder:"ou=hwengg,dc=min,dc=io;ou=swengg,dc=min,dc=io"}),(0,_.jsx)(r.cl_,{id:"ad_groupSearchFilter",name:"ad_groupSearchFilter",onChange:e=>{E(e.target.value)},label:"Group Search Filter",value:M,placeholder:"(&(objectclass=groupOfNames)(member=%s))"})]}),(0,_.jsx)(r.azJ,{sx:l.U.modalButtonBar,children:(0,_.jsx)(r.$nd,{id:"save-idp",type:"submit",variant:"callAction",color:"primary",disabled:!ie||m,onClick:()=>v(!0),label:"Save"})}),"AD"===x&&(0,_.jsxs)(n.Fragment,{children:[(0,_.jsx)(r._xt,{separator:!0,children:"User & Group management"}),(0,_.jsx)("br",{}),(0,_.jsxs)("fieldset",{className:"inputItem",children:[(0,_.jsx)("legend",{children:"List of user DNs (Distinguished Names) to be added as Tenant Administrators"}),(0,_.jsx)(r.xA9,{item:!0,xs:12,children:Q.map(((e,a)=>(0,_.jsx)(n.Fragment,{children:(0,_.jsxs)(r.azJ,{sx:{display:"flex",marginBottom:10},children:[(0,_.jsx)(r.cl_,{id:"ad-userdn-".concat(a.toString()),label:"",placeholder:"",name:"ad-userdn-".concat(a.toString()),value:Q[a],onChange:e=>{X(Q.map(((t,n)=>n===a?e.target.value:t)))},index:a,error:te["ad-userdn-".concat(a.toString())]||""},"csv-ad-userdn-".concat(a.toString())),(0,_.jsxs)(r.azJ,{sx:{marginLeft:10,display:"flex",height:38},children:[(0,_.jsx)(r.m_M,{tooltip:"Add User","aria-label":"add",children:(0,_.jsx)(r.K0,{size:"small",onClick:()=>{X([...Q,""])},children:(0,_.jsx)(r.REV,{})})}),(0,_.jsx)(r.m_M,{tooltip:"Remove","aria-label":"add",children:(0,_.jsx)(r.K0,{size:"small",style:{marginLeft:16},onClick:()=>{Q.length>1&&X(Q.filter(((e,t)=>t!==a)))},children:(0,_.jsx)(r.d7y,{})})})]})]})},"identityField-".concat(a.toString()))))})]}),(0,_.jsxs)("fieldset",{className:"inputItem",children:[(0,_.jsx)("legend",{children:"List of group DNs (Distinguished Names) to be added as Tenant Administrators"}),(0,_.jsx)(r.xA9,{item:!0,xs:12,children:ee.map(((e,a)=>(0,_.jsx)(n.Fragment,{children:(0,_.jsxs)(r.azJ,{sx:{display:"flex",marginBottom:10},children:[(0,_.jsx)(r.cl_,{id:"ad-groupdn-".concat(a.toString()),label:"",placeholder:"",name:"ad-groupdn-".concat(a.toString()),value:ee[a],onChange:e=>{ae(ee.map(((t,n)=>n===a?e.target.value:t)))},index:a,error:te["ad-groupdn-".concat(a.toString())]||""},"csv-ad-groupdn-".concat(a.toString())),(0,_.jsxs)(r.azJ,{sx:{marginLeft:10,display:"flex",height:38},children:[(0,_.jsx)(r.m_M,{tooltip:"Add Group","aria-label":"add",children:(0,_.jsx)(r.K0,{size:"small",onClick:()=>{ae([...ee,""])},children:(0,_.jsx)(r.REV,{})})}),(0,_.jsx)(r.m_M,{tooltip:"Remove","aria-label":"add",children:(0,_.jsx)(r.K0,{size:"small",style:{marginLeft:16},onClick:()=>{ee.length>1&&ae(ee.filter(((e,t)=>t!==a)))},children:(0,_.jsx)(r.d7y,{})})})]})]})},"identityField-".concat(a.toString()))))})]}),(0,_.jsx)("br",{}),(0,_.jsx)(r.azJ,{sx:l.U.modalButtonBar,children:(0,_.jsx)(r.$nd,{id:"add-additional-dns",type:"submit",variant:"callAction",disabled:!ie||m,onClick:()=>(()=>{h(!0);let t={};"AD"===x&&(t={user_dns:Q.filter((e=>""!==e.trim())),group_dns:ee.filter((e=>""!==e.trim()))});p.A.invoke("POST","/api/v1/namespaces/".concat(null===a||void 0===a?void 0:a.namespace,"/tenants/").concat(null===a||void 0===a?void 0:a.name,"/set-administrators"),t).then((()=>{h(!1),ae([""]),X([""]),se(),e((0,d.Hk)("Administrators added successfully"))})).catch((a=>{e((0,d.C9)(a)),h(!1)}))})(),label:"Add additional DNs"})})]})]})]})]})}}}]);
//# sourceMappingURL=682.2ebc8fc9.chunk.js.map